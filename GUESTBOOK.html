<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guestbook - Livro de Visitas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* RESET E CONFIGURAÇÕES GERAIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        
        /* CABEÇALHO */
        .header {
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header h1 i {
            color: #ffd700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .guest-count {
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 30px;
            display: inline-block;
            margin-top: 15px;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }
        
        /* SEÇÃO DE NOVA MENSAGEM */
        .new-message {
            padding: 40px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
        }
        
        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        .guestbook-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        .rating {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }
        
        .rating input {
            display: none;
        }
        
        .rating label {
            font-size: 30px;
            color: #ddd;
            cursor: pointer;
            margin: 0;
            transition: color 0.3s;
        }
        
        .rating label:hover,
        .rating label:hover ~ label,
        .rating input:checked ~ label {
            color: #ffd700;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        /* LISTA DE MENSAGENS */
        .messages-section {
            padding: 40px 30px;
        }
        
        .messages-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .sort-options {
            display: flex;
            gap: 10px;
        }
        
        .sort-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sort-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .sort-btn:hover:not(.active) {
            background: #e9ecef;
        }
        
        .messages-list {
            display: grid;
            gap: 25px;
        }
        
        .message-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 5px solid #3498db;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .message-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .message-card.new {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .message-author {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .author-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .author-info h4 {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .author-info .date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .message-rating {
            color: #ffd700;
            font-size: 1.2rem;
        }
        
        .message-content {
            color: #2c3e50;
            line-height: 1.7;
            margin-bottom: 15px;
            padding-left: 75px;
        }
        
        .message-actions {
            display: flex;
            gap: 15px;
            padding-left: 75px;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #7f8c8d;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            transition: color 0.3s;
        }
        
        .action-btn:hover {
            color: #3498db;
        }
        
        .like-btn:hover {
            color: #e74c3c;
        }
        
        .reply-btn:hover {
            color: #2ecc71;
        }
        
        .report-btn:hover {
            color: #e74c3c;
        }
        
        .likes-count {
            margin-left: 5px;
            font-weight: 600;
        }
        
        /* MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: slideUp 0.4s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: #7f8c8d;
            text-decoration: none;
            cursor: pointer;
        }
        
        .close-modal:hover {
            color: #e74c3c;
        }
        
        /* PAGINAÇÃO */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 50px;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #ddd;
            background: white;
            color: #666;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .page-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .page-btn:hover:not(.active) {
            background: #f8f9fa;
        }
        
        /* RODAPÉ */
        .footer {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .footer p {
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .social-link:hover {
            background: #3498db;
            transform: translateY(-3px);
        }
        
        /* MENSAGEM VAZIA */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 80px;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .message-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .message-content, .message-actions {
                padding-left: 0;
            }
            
            .messages-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .sort-options {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                border-radius: 10px;
            }
            
            .header, .new-message, .messages-section {
                padding: 30px 20px;
            }
            
            .guestbook-form {
                padding: 20px;
            }
            
            .message-card {
                padding: 20px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- CABEÇALHO -->
        <header class="header">
            <h1>
                <i class="fas fa-book-open"></i>
                Guestbook - Livro de Visitas
            </h1>
            <p>Deixe sua mensagem, comentário ou feedback. Sua opinião é muito importante para nós!</p>
            <div class="guest-count">
                <i class="fas fa-users"></i>
                <span id="totalMessages">0</span> Mensagens
            </div>
        </header>
        
        <!-- NOVA MENSAGEM -->
        <section class="new-message">
            <h2 class="section-title">
                <i class="fas fa-pen"></i>
                Deixe sua mensagem
            </h2>
            
            <form class="guestbook-form" id="guestbookForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">
                            <i class="fas fa-user"></i>
                            Nome *
                        </label>
                        <input type="text" 
                               id="name" 
                               class="form-control" 
                               placeholder="Seu nome completo"
                               required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i>
                            E-mail
                        </label>
                        <input type="email" 
                               id="email" 
                               class="form-control" 
                               placeholder="seu@email.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="message">
                        <i class="fas fa-comment"></i>
                        Sua mensagem *
                    </label>
                    <textarea id="message" 
                              class="form-control" 
                              placeholder="Escreva sua mensagem aqui..."
                              required></textarea>
                </div>
                
                <div class="form-group">
                    <label>
                        <i class="fas fa-star"></i>
                        Avaliação (opcional)
                    </label>
                    <div class="rating">
                        <input type="radio" id="star5" name="rating" value="5">
                        <label for="star5" title="Excelente">★</label>
                        
                        <input type="radio" id="star4" name="rating" value="4">
                        <label for="star4" title="Muito bom">★</label>
                        
                        <input type="radio" id="star3" name="rating" value="3">
                        <label for="star3" title="Bom">★</label>
                        
                        <input type="radio" id="star2" name="rating" value="2">
                        <label for="star2" title="Regular">★</label>
                        
                        <input type="radio" id="star1" name="rating" value="1">
                        <label for="star1" title="Ruim">★</label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="reset" class="btn btn-secondary">
                        <i class="fas fa-eraser"></i>
                        Limpar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i>
                        Enviar Mensagem
                    </button>
                </div>
            </form>
        </section>
        
        <!-- MENSAGENS EXISTENTES -->
        <section class="messages-section">
            <div class="messages-header">
                <h2 class="section-title">
                    <i class="fas fa-comments"></i>
                    Mensagens dos Visitantes
                </h2>
                
                <div class="sort-options">
                    <button class="sort-btn active" data-sort="newest">Mais Recentes</button>
                    <button class="sort-btn" data-sort="oldest">Mais Antigas</button>
                    <button class="sort-btn" data-sort="best">Melhor Avaliadas</button>
                </div>
            </div>
            
            <div class="messages-list" id="messagesList">
                <!-- Mensagens serão carregadas aqui via JavaScript -->
                <div class="empty-state" id="emptyState">
                    <i class="fas fa-comment-slash"></i>
                    <h3>Nenhuma mensagem ainda</h3>
                    <p>Seja o primeiro a deixar uma mensagem!</p>
                </div>
            </div>
            
            <!-- PAGINAÇÃO -->
            <div class="pagination" id="pagination" style="display: none;">
                <!-- Paginação será gerada via JavaScript -->
            </div>
        </section>
        
        <!-- RODAPÉ -->
        <footer class="footer">
            <p>
                <i class="far fa-copyright"></i>
                2024 Guestbook - Todos os direitos reservados
            </p>
            <p>As mensagens são salvas localmente no seu navegador.</p>
            
            <div class="social-links">
                <button class="social-link" id="exportBtn" title="Exportar mensagens">
                    <i class="fas fa-download"></i>
                </button>
                <button class="social-link" id="importBtn" title="Importar mensagens">
                    <i class="fas fa-upload"></i>
                </button>
                <button class="social-link" id="clearBtn" title="Limpar todas as mensagens">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="social-link" id="backupBtn" title="Fazer backup">
                    <i class="fas fa-save"></i>
                </button>
            </div>
        </footer>
    </div>
    
    <!-- MODAL DE CONFIRMAÇÃO -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            
            <div style="font-size: 60px; color: #2ecc71; margin-bottom: 20px;">
                <i class="fas fa-check-circle"></i>
            </div>
            
            <h2 style="color: #2c3e50; margin-bottom: 15px;">Mensagem Enviada!</h2>
            
            <p style="color: #666; line-height: 1.6; margin-bottom: 25px;" id="modalMessage">
                Obrigado por deixar sua mensagem! Ela foi salva com sucesso.
            </p>
            
            <button class="btn btn-primary" id="modalOkBtn">
                <i class="fas fa-check"></i>
                OK
            </button>
        </div>
    </div>
    
    <!-- MODAL DE CONFIRMAÇÃO DE EXCLUSÃO -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <span class="close-modal" id="closeDeleteModal">&times;</span>
            
            <div style="font-size: 60px; color: #e74c3c; margin-bottom: 20px;">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            
            <h2 style="color: #2c3e50; margin-bottom: 15px;">Confirmar Exclusão</h2>
            
            <p style="color: #666; line-height: 1.6; margin-bottom: 25px;" id="deleteMessage">
                Tem certeza que deseja excluir esta mensagem? Esta ação não pode ser desfeita.
            </p>
            
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-secondary" id="cancelDeleteBtn">
                    Cancelar
                </button>
                <button class="btn btn-primary" id="confirmDeleteBtn" style="background: #e74c3c;">
                    <i class="fas fa-trash"></i>
                    Excluir
                </button>
            </div>
        </div>
    </div>

    <script>
        // ====================
        // VARIÁVEIS GLOBAIS
        // ====================
        let messages = [];
        let currentSort = 'newest';
        let currentPage = 1;
        const messagesPerPage = 5;
        let messageToDelete = null;

        // ====================
        // FUNÇÕES DE STORAGE
        // ====================
        
        // Salvar mensagens no localStorage
        function saveMessages() {
            try {
                localStorage.setItem('guestbook_messages', JSON.stringify(messages));
                updateMessageCount();
                console.log('Mensagens salvas com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar mensagens:', error);
                showError('Erro ao salvar mensagens. Tente novamente.');
            }
        }

        // Carregar mensagens do localStorage
        function loadMessages() {
            try {
                const savedMessages = localStorage.getItem('guestbook_messages');
                if (savedMessages) {
                    messages = JSON.parse(savedMessages);
                } else {
                    // Mensagens de exemplo iniciais
                    messages = [
                        {
                            id: 1,
                            name: 'Maria Silva',
                            email: 'maria@email.com',
                            message: 'Adorei o site! Conteúdo muito bem organizado e fácil de navegar. As informações são claras e úteis.',
                            rating: 5,
                            date: '2024-01-15T10:30:00',
                            likes: 24
                        },
                        {
                            id: 2,
                            name: 'João Santos',
                            email: 'joao@email.com',
                            message: 'Site muito interessante e com conteúdo relevante. Achei a interface moderna e responsiva.',
                            rating: 4,
                            date: '2024-01-12T14:45:00',
                            likes: 18
                        },
                        {
                            id: 3,
                            name: 'Ana Oliveira',
                            email: 'ana@email.com',
                            message: 'Parabéns pela iniciativa! Como desenvolvedora júnior, encontrei muitos recursos úteis aqui.',
                            rating: 5,
                            date: '2024-01-08T16:20:00',
                            likes: 32
                        }
                    ];
                    saveMessages();
                }
                updateMessageCount();
                renderMessages();
            } catch (error) {
                console.error('Erro ao carregar mensagens:', error);
                showError('Erro ao carregar mensagens. Tente recarregar a página.');
            }
        }

        // ====================
        // FUNÇÕES DE RENDERIZAÇÃO
        // ====================
        
        // Atualizar contador de mensagens
        function updateMessageCount() {
            const countElement = document.getElementById('totalMessages');
            if (countElement) {
                countElement.textContent = messages.length;
            }
        }

        // Gerar avatar baseado no nome
        function generateAvatar(name) {
            if (!name) return '??';
            const names = name.split(' ');
            if (names.length >= 2) {
                return (names[0][0] + names[1][0]).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        // Formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                // Hoje
                return `Hoje às ${date.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}`;
            } else if (diffDays === 1) {
                // Ontem
                return `Ontem às ${date.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}`;
            } else if (diffDays < 7) {
                // Esta semana
                const days = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
                return `${days[date.getDay()]} às ${date.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}`;
            } else {
                // Mais antigo
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        // Gerar estrelas de avaliação
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '★';
                } else {
                    stars += '☆';
                }
            }
            return stars;
        }

        // Ordenar mensagens
        function sortMessages() {
            switch(currentSort) {
                case 'newest':
                    return [...messages].sort((a, b) => new Date(b.date) - new Date(a.date));
                case 'oldest':
                    return [...messages].sort((a, b) => new Date(a.date) - new Date(b.date));
                case 'best':
                    return [...messages].sort((a, b) => {
                        if (b.rating !== a.rating) {
                            return b.rating - a.rating;
                        }
                        return new Date(b.date) - new Date(a.date);
                    });
                default:
                    return messages;
            }
        }

        // Renderizar mensagens
        function renderMessages() {
            const messagesList = document.getElementById('messagesList');
            const emptyState = document.getElementById('emptyState');
            const pagination = document.getElementById('pagination');
            
            if (!messagesList) return;
            
            // Limpar lista
            messagesList.innerHTML = '';
            
            if (messages.length === 0) {
                emptyState.style.display = 'block';
                pagination.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Ordenar mensagens
            const sortedMessages = sortMessages();
            
            // Paginação
            const totalPages = Math.ceil(sortedMessages.length / messagesPerPage);
            const startIndex = (currentPage - 1) * messagesPerPage;
            const endIndex = startIndex + messagesPerPage;
            const pageMessages = sortedMessages.slice(startIndex, endIndex);
            
            // Renderizar mensagens da página atual
            pageMessages.forEach((msg, index) => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message-card';
                if (index === 0 && pageMessages.length > 0) {
                    messageElement.classList.add('new');
                }
                
                messageElement.innerHTML = `
                    <div class="message-header">
                        <div class="message-author">
                            <div class="author-avatar">${generateAvatar(msg.name)}</div>
                            <div class="author-info">
                                <h4>${msg.name}</h4>
                                <div class="date">
                                    <i class="far fa-calendar"></i>
                                    ${formatDate(msg.date)}
                                    ${msg.email ? `<br><small>${msg.email}</small>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div class="message-rating">
                            ${generateStars(msg.rating)}
                        </div>
                    </div>
                    
                    <div class="message-content">
                        <p>${msg.message.replace(/\n/g, '<br>')}</p>
                    </div>
                    
                    <div class="message-actions">
                        <button class="action-btn like-btn" onclick="likeMessage(${msg.id})">
                            <i class="far fa-thumbs-up"></i>
                            Curtir <span class="likes-count">(${msg.likes || 0})</span>
                        </button>
                        
                        <button class="action-btn reply-btn" onclick="replyToMessage(${msg.id})">
                            <i class="fas fa-reply"></i>
                            Responder
                        </button>
                        
                        <button class="action-btn report-btn" onclick="deleteMessagePrompt(${msg.id})">
                            <i class="fas fa-trash"></i>
                            Excluir
                        </button>
                    </div>
                `;
                
                messagesList.appendChild(messageElement);
            });
            
            // Renderizar paginação
            if (totalPages > 1) {
                pagination.style.display = 'flex';
                let paginationHTML = '';
                
                for (let i = 1; i <= totalPages; i++) {
                    paginationHTML += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                }
                
                pagination.innerHTML = paginationHTML;
            } else {
                pagination.style.display = 'none';
            }
        }

        // ====================
        // FUNÇÕES DE INTERAÇÃO
        // ====================
        
        // Adicionar nova mensagem
        function addMessage(event) {
            event.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const message = document.getElementById('message').value.trim();
            const ratingInputs = document.querySelectorAll('input[name="rating"]:checked');
            const rating = ratingInputs.length > 0 ? parseInt(ratingInputs[0].value) : 0;
            
            // Validação
            if (!name || !message) {
                showError('Por favor, preencha pelo menos o nome e a mensagem.');
                return;
            }
            
            // Criar nova mensagem
            const newMessage = {
                id: Date.now(), // ID único baseado no timestamp
                name: name,
                email: email,
                message: message,
                rating: rating,
                date: new Date().toISOString(),
                likes: 0
            };
            
            // Adicionar ao array
            messages.unshift(newMessage);
            
            // Salvar no localStorage
            saveMessages();
            
            // Resetar formulário
            document.getElementById('guestbookForm').reset();
            
            // Resetar para primeira página e ordenação mais recente
            currentPage = 1;
            currentSort = 'newest';
            updateSortButtons();
            
            // Renderizar mensagens
            renderMessages();
            
            // Mostrar modal de confirmação
            showConfirmationModal();
        }

        // Curtir mensagem
        function likeMessage(messageId) {
            const messageIndex = messages.findIndex(msg => msg.id === messageId);
            if (messageIndex !== -1) {
                if (!messages[messageIndex].likes) {
                    messages[messageIndex].likes = 0;
                }
                messages[messageIndex].likes++;
                saveMessages();
                renderMessages();
            }
        }

        // Responder a mensagem (placeholder)
        function replyToMessage(messageId) {
            alert('Funcionalidade de resposta em desenvolvimento!');
        }

        // Solicitar exclusão de mensagem
        function deleteMessagePrompt(messageId) {
            messageToDelete = messageId;
            const message = messages.find(msg => msg.id === messageId);
            const deleteMessage = document.getElementById('deleteMessage');
            if (message && deleteMessage) {
                deleteMessage.innerHTML = `
                    Tem certeza que deseja excluir a mensagem de <strong>${message.name}</strong>?<br>
                    Esta ação não pode ser desfeita.
                `;
            }
            showModal('deleteModal');
        }

        // Confirmar exclusão de mensagem
        function confirmDeleteMessage() {
            if (messageToDelete) {
                messages = messages.filter(msg => msg.id !== messageToDelete);
                saveMessages();
                renderMessages();
                messageToDelete = null;
                hideModal('deleteModal');
            }
        }

        // Mudar página
        function changePage(page) {
            currentPage = page;
            renderMessages();
        }

        // Mudar ordenação
        function changeSort(sortType) {
            currentSort = sortType;
            currentPage = 1;
            updateSortButtons();
            renderMessages();
        }

        // Atualizar botões de ordenação
        function updateSortButtons() {
            document.querySelectorAll('.sort-btn').forEach(btn => {
                if (btn.dataset.sort === currentSort) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // ====================
        // FUNÇÕES DE MODAL
        // ====================
        
        // Mostrar modal
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
            }
        }

        // Esconder modal
        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Mostrar modal de confirmação
        function showConfirmationModal() {
            showModal('confirmationModal');
        }

        // Mostrar erro
        function showError(message) {
            alert(`Erro: ${message}`);
        }

        // ====================
        // FUNÇÕES DE EXPORTAÇÃO/IMPORTAÇÃO
        // ====================
        
        // Exportar mensagens
        function exportMessages() {
            try {
                const dataStr = JSON.stringify(messages, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `guestbook_backup_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                alert('Mensagens exportadas com sucesso!');
            } catch (error) {
                console.error('Erro ao exportar mensagens:', error);
                showError('Erro ao exportar mensagens.');
            }
        }

        // Importar mensagens
        function importMessages() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedMessages = JSON.parse(e.target.result);
                        
                        if (!Array.isArray(importedMessages)) {
                            throw new Error('Formato de arquivo inválido');
                        }
                        
                        // Validar cada mensagem
                        const validMessages = importedMessages.filter(msg => 
                            msg && 
                            typeof msg === 'object' && 
                            msg.name && 
                            msg.message &&
                            msg.date
                        );
                        
                        if (validMessages.length === 0) {
                            throw new Error('Nenhuma mensagem válida encontrada no arquivo');
                        }
                        
                        // Adicionar novas mensagens
                        validMessages.forEach(msg => {
                            // Garantir que tenha um ID único
                            if (!msg.id || messages.some(m => m.id === msg.id)) {
                                msg.id = Date.now() + Math.random();
                            }
                            messages.push(msg);
                        });
                        
                        saveMessages();
                        renderMessages();
                        alert(`${validMessages.length} mensagens importadas com sucesso!`);
                        
                    } catch (error) {
                        console.error('Erro ao importar mensagens:', error);
                        showError('Erro ao importar mensagens. Verifique se o arquivo está no formato correto.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Fazer backup
        function backupMessages() {
            // Simplesmente salva no localStorage (já está sendo feito)
            saveMessages();
            alert('Backup realizado com sucesso! As mensagens foram salvas no seu navegador.');
        }

        // Limpar todas as mensagens
        function clearAllMessages() {
            if (confirm('Tem certeza que deseja excluir TODAS as mensagens? Esta ação não pode ser desfeita.')) {
                messages = [];
                saveMessages();
                renderMessages();
                alert('Todas as mensagens foram excluídas.');
            }
        }

        // ====================
        // INICIALIZAÇÃO
        // ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar mensagens
            loadMessages();
            
            // Event Listeners do formulário
            document.getElementById('guestbookForm').addEventListener('submit', addMessage);
            
            // Event Listeners dos botões de ordenação
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    changeSort(this.dataset.sort);
                });
            });
            
            // Event Listeners dos modais
            document.getElementById('closeModal').addEventListener('click', function() {
                hideModal('confirmationModal');
            });
            
            document.getElementById('modalOkBtn').addEventListener('click', function() {
                hideModal('confirmationModal');
            });
            
            document.getElementById('closeDeleteModal').addEventListener('click', function() {
                hideModal('deleteModal');
            });
            
            document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
                hideModal('deleteModal');
            });
            
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDeleteMessage);
            
            // Event Listeners dos botões do rodapé
            document.getElementById('exportBtn').addEventListener('click', exportMessages);
            document.getElementById('importBtn').addEventListener('click', importMessages);
            document.getElementById('clearBtn').addEventListener('click', clearAllMessages);
            document.getElementById('backupBtn').addEventListener('click', backupMessages);
            
            // Fechar modal ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideModal(this.id);
                    }
                });
            });
        });
    </script>
</body>
</html>